{% extends "base.html" %}
{% load static %}

{% block title %}Vulnerable Registration (LAB){% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/vuln_register.css' %}">
{% endblock %}

{% block content %}
<div class="login-container" style="max-width:700px;margin:2rem auto;padding:1.4rem;border-radius:8px;border:1px solid #f8d7da;background:#fff5f6;">
  <h2 style="color:#9b1c1c;">⚠ Vulnerable Registration (LAB)</h2>

  <div style="background:#fff1f2;border-left:4px solid #ef4444;padding:10px 12px;margin:12px 0;border-radius:6px;">
    <strong>LAB WARNING:</strong>
    <p style="margin:.25rem 0 0 0;color:#7f1d1d;">
      This registration intentionally stores passwords in <em>plaintext</em> (VulnUser). Use only in an isolated lab environment.
    </p>
    <p style="margin:.25rem 0 0 0;font-size:.9rem;color:#a11f1f;">Teaching note: after registering, inspect the database (locally) to see the stored plaintext password.</p>
  </div>

  {% if form %}
    <form method="POST" aria-label="Vulnerable registration form">
      {% csrf_token %}
      {{ form.non_field_errors }}
      <div style="margin-bottom:.6rem;">
        {{ form.username.label_tag }}<br>
        {{ form.username }}
        {% if form.username.errors %}<div class="field-errors">{{ form.username.errors }}</div>{% endif %}
      </div>

      <div style="margin-bottom:.6rem;">
        {{ form.email.label_tag }}<br>
        {{ form.email }}
        {% if form.email.errors %}<div class="field-errors">{{ form.email.errors }}</div>{% endif %}
      </div>

      <div style="margin-bottom:.6rem;">
        {{ form.password.label_tag }}<br>
        {{ form.password }}
        {% if form.password.help_text %}<div class="help-text" style="color:#7f1d1d;font-size:.9rem;">{{ form.password.help_text }}</div>{% endif %}
        {% if form.password.errors %}<div class="field-errors">{{ form.password.errors }}</div>{% endif %}
      </div>

      <div style="display:flex;gap:.6rem;align-items:center;margin-top:.6rem;">
        <button type="submit" style="background:#9b1c1c;color:#fff;border:none;padding:.6rem 1rem;border-radius:6px;cursor:pointer;">
          Register (VULN)
        </button>
        <a href="{% url 'accounts:vuln_login' %}" style="margin-left:8px;color:#9b1c1c;text-decoration:underline;">Vulnerable Login</a>
      </div>
    </form>
  {% else %}
    <!-- fallback plain form -->
    <form method="POST">
      {% csrf_token %}
      <label>Username</label><br>
      <input type="text" name="username" required style="width:100%;padding:.5rem;border:1px solid #ddd;border-radius:6px;"><br><br>

      <label>Email</label><br>
      <input type="email" name="email" required style="width:100%;padding:.5rem;border:1px solid #ddd;border-radius:6px;"><br><br>

      <label>Password (will be stored plaintext)</label><br>
      <input type="text" name="password" required style="width:100%;padding:.5rem;border:1px solid #ddd;border-radius:6px;">
      <div style="margin-top:.5rem;color:#b91c1c;font-size:.9rem;">⚠ This password will be stored as plaintext (lab only).</div><br>

      <button type="submit" style="background:#9b1c1c;color:#fff;padding:.6rem 1rem;border:none;border-radius:6px;cursor:pointer;">Register (VULN)</button>
    </form>
  {% endif %}

  {% if messages %}
    <div class="messages" style="margin-top:12px;">
      {% for message in messages %}
        <p class="{{ message.tags }}">{{ message }}</p>
      {% endfor %}
    </div>
  {% endif %}
</div>
{% endblock %}
