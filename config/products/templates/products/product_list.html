{% extends "base.html" %}
{% load static %}

{% block title %}
  Products{% if mode == "vuln" %} (Vulnerable){% endif %}
{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/product_list.css' %}">
<style>
.vuln-alert {
    background: #ffe5e5;
    border: 2px solid #cc0000;
    color: #cc0000;
    padding: 10px;
    border-radius: 5px;
    margin-bottom: 1.5rem;
    font-weight: bold;
}
.product-grid {
    display: flex;
    gap: 1rem;
}
.product-column {
    flex: 1;
}
.product-card {
    border: 1px solid #ddd;
    border-radius: 4px;
    padding: 0.75rem;
    margin-bottom: 1rem;
    text-align: center;
}
.product-card img {
    max-width: 140px;
    max-height: 140px;
    object-fit: contain;
    margin-bottom: 0.5rem;
}
.category-list {
    margin-bottom: 1rem;
}
.category-list a {
    display: block;
}
</style>
{% endblock %}

{% block content %}

{% if mode == "vuln" %}
  <div class="vuln-alert">
      âš  VULNERABLE MODE: Products are loaded using <strong>raw SQL</strong>. Input is not validated and may expose security risks.
  </div>
{% endif %}

<div class="product-grid">
    <div class="product-column">
        <h4>Categories</h4>
        <div class="category-list">
            {% for cat in categories %}
                <a href="{% url 'products:product_list_by_category' cat.slug %}">
                    {{ cat.name }}
                </a>
            {% empty %}
                <p>No categories available.</p>
            {% endfor %}
        </div>
    </div>

    <div class="product-column">
        {% for p in results %}
            <div class="product-card">
                {# image_url for vuln dicts, image for secure queryset #}
                {% if p.image_url %}
                    <img src="{{ p.image_url }}" alt="{{ p.name }}">
                {% elif p.image %}
                    <img src="{{ p.image.url }}" alt="{{ p.name }}">
                {% endif %}

                <h5>{{ p.name }}</h5>
                <p>${{ p.price }}</p>

                {# Use slug exactly as stored in DB (# secure: smartphone, vuln: smartphone-vuln) #}
                <a href="{% url 'products:product_detail' p.slug %}">View</a>

            </div>
        {% empty %}
            <p>No products found.</p>
        {% endfor %}
    </div>
</div>

{% endblock %}
