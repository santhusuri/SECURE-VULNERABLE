{% extends "base.html" %}
{% load static %}

{% block title %}
  {{ product.name }}{% if mode == "vuln" %} (Vulnerable){% endif %}
{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/product_detail.css' %}">
<style>
.vuln-alert {
    background: #ffe5e5;
    border: 2px solid #cc0000;
    color: #cc0000;
    padding: 10px;
    border-radius: 5px;
    margin-bottom: 1.5rem;
    font-weight: bold;
}
</style>
{% endblock %}

{% block content %}
{% if mode == "vuln" %}
  <div class="vuln-alert">
      âš  VULNERABLE MODE: This product detail is fetched using <strong>raw SQL</strong>.
      No proper CSRF protection is applied when adding to cart.
  </div>
{% endif %}

<h2>{{ product.name }}</h2>
<p><strong>Price:</strong> ${{ product.price }}</p>

<p>
  {% if mode == "vuln" %}
    {{ product.description|safe }}
  {% else %}
    {{ product.description }}
  {% endif %}
</p>

{% if product.image_url %}
  <img src="{{ product.image_url }}" alt="{{ product.name }}" style="max-width:250px;">
{% elif product.image %}
  <img src="{{ product.image.url }}" alt="{{ product.name }}" style="max-width:250px;">
{% endif %}

<form action="{% url 'cart:add_to_cart' product.id %}" method="post">
    {% if mode == "secure" %}
        {% csrf_token %}
        <button type="submit">Add to Cart</button>
    {% else %}
        <input type="hidden" name="csrfmiddlewaretoken" value="invalid_token">
        <button type="submit">Add to Cart (Insecure)</button>
    {% endif %}
</form>
{% endblock %}
