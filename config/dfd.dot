digraph DFD {
  rankdir=TB;
  node [shape=box];

  User [label="User"];
  Stripe [label="Stripe Gateway"];
  Shipping [label="Shipping Provider"];

  P1 [shape=circle, label="P1: Authenticate"];
  P2 [shape=circle, label="P2: Browse Products"];
  P3 [shape=circle, label="P3: Manage Cart"];
  P4 [shape=circle, label="P4: Process Order"];
  P5 [shape=circle, label="P5: Handle Payment"];
  P6 [shape=circle, label="P6: Manage Shipment"];
  P7 [shape=circle, label="P7: Log Security"];
  P8 [shape=circle, label="P8: Input Validation"];

  DS1 [shape=cylinder, label="DS1: User DB"];
  DS2 [shape=cylinder, label="DS2: Product DB"];
  DS3 [shape=cylinder, label="DS3: Order DB"];
  DS4 [shape=cylinder, label="DS4: Shipment DB"];
  DS5 [shape=cylinder, label="DS5: Security Log DB"];

  User -> P1 [label="login data"];
  P1 -> DS1 [label="user info"];
  DS1 -> P1 [label="user data"];

  User -> P2 [label="browse request"];
  P2 -> DS2 [label="product data"];
  DS2 -> P2 [label="products"];

  User -> P3 [label="cart actions"];
  P3 -> User [label="cart updates"];

  User -> P4 [label="order request"];
  P4 -> P8 [label="order data"];
  P8 -> P4 [label="validated data"];
  P4 -> DS3 [label="order data"];
  DS3 -> P4 [label="order info"];

  P4 -> P5 [label="payment data"];
  P5 -> Stripe [label="secure payment"];
  Stripe -> P5 [label="payment confirmation"];

  P4 -> P6 [label="shipment request"];
  P6 -> DS4 [label="shipment data"];
  DS4 -> P6 [label="shipment info"];
  P6 -> Shipping [label="tracking updates"];

  P1 -> P7 [label="security events"];
  P2 -> P7;
  P3 -> P7;
  P4 -> P7;
  P5 -> P7;
  P6 -> P7;
  P7 -> DS5 [label="logs"];
}
